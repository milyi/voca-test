<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ë‹¨ì–´ ì•”ê¸° ë„ìš°ë¯¸</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 400px; margin: auto; padding: 20px; }
    h2 { text-align: center; }
    input[type="text"] { width: 100%; padding: 10px; font-size: 16px; }
    button { padding: 10px; width: 100%; margin-top: 10px; }
  </style>
</head>
<body>

<h2>ğŸ“˜ ì˜ë‹¨ì–´ ì•”ê¸° ë„ìš°ë¯¸</h2>

<div id="upload">
  <input type="file" accept="image/*" id="imageInput">
  <button onclick="runOCR()">ì‚¬ì§„ì—ì„œ ë‹¨ì–´ ì¸ì‹</button>
</div>

<div id="quiz" style="display:none;">
  <p id="meaning"></p>
  <input type="text" id="answer" placeholder="ì˜ë‹¨ì–´ ì…ë ¥">
  <button onclick="next()">ë‹¤ìŒ</button>
</div>

<div id="result" style="display:none;"></div>

<script>
let words = [];
let index = 0;
let results = [];

function runOCR() {
  const file = document.getElementById('imageInput').files[0];
  if (!file) return alert("ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”.");

  Tesseract.recognize(file, 'eng+kor')
    .then(({ data: { text } }) => {
      words = text.split('\n')
        .map(line => line.trim().split(' '))
        .filter(v => v.length >= 2)
        .map(v => ({ word: v[0], meaning: v.slice(1).join(' ') }));

      if (words.length === 0) return alert("ë‹¨ì–´ë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");

      shuffle(words);
      document.getElementById('upload').style.display = 'none';
      document.getElementById('quiz').style.display = 'block';
      show();
    });
}

function show() {
  document.getElementById('meaning').innerText =
    `ëœ»: ${words[index].meaning}`;
  document.getElementById('answer').value = '';
}

function next() {
  const user = document.getElementById('answer').value.trim();
  results.push({
    ...words[index],
    user,
    correct: user.toLowerCase() === words[index].word.toLowerCase()
  });

  index++;
  if (index < words.length) show();
  else finish();
}

function finish() {
  document.getElementById('quiz').style.display = 'none';
  let html = `<h3>ê²°ê³¼</h3>`;
  let score = results.filter(r => r.correct).length;
  html += `<p>ì ìˆ˜: ${score} / ${results.length}</p><ul>`;
  results.forEach(r => {
    html += `<li>${r.meaning} â†’ ${r.user || '(ë¬´ì‘ë‹µ)'} / ${r.word}</li>`;
  });
  html += `</ul><button onclick="location.reload()">ë‹¤ì‹œ ì‹œí—˜</button>`;
  document.getElementById('result').innerHTML = html;
  document.getElementById('result').style.display = 'block';
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}
</script>

</body>
</html>