<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ë‹¨ì–´ ì•”ê¸° ë„ìš°ë¯¸</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; max-width: 420px; margin: auto; padding: 20px; }
    h2 { text-align: center; }
    input { width: 100%; padding: 10px; font-size: 16px; margin-top: 8px; }
    button { padding: 12px; width: 100%; margin-top: 10px; font-size: 16px; }
    .question { font-weight: bold; margin-bottom: 10px; }
  </style>
</head>
<body>

<h2>ğŸ“˜ ì˜ë‹¨ì–´ ì•”ê¸° ë„ìš°ë¯¸</h2>

<!-- 1. ì‚¬ì§„ ì´¬ì˜ -->
<div id="upload">
  <input type="file" accept="image/*" capture="environment" id="imageInput">
  <button onclick="runOCR()">ğŸ“· ë‹¨ì–´ ì‚¬ì§„ ì°ê¸°</button>
  <p style="font-size:14px;">
    í˜•ì‹ ì˜ˆì‹œ:<br>
    apple a round fruit with red skin ì‚¬ê³¼
  </p>
</div>

<!-- 2. ì‹œí—˜ -->
<div id="quiz" style="display:none;">
  <div class="question" id="definition"></div>
  <input type="text" id="wordInput" placeholder="ì˜ë‹¨ì–´ ì…ë ¥">
  <input type="text" id="meaningInput" placeholder="ëœ» ì…ë ¥">
  <button onclick="next()">ë‹¤ìŒ</button>
</div>

<!-- 3. ê²°ê³¼ -->
<div id="result" style="display:none;"></div>

<script>
let words = [];
let index = 0;
let results = [];

function runOCR() {
  const file = document.getElementById('imageInput').files[0];
  if (!file) return alert("ì‚¬ì§„ì„ ì°ì–´ì£¼ì„¸ìš”.");

  Tesseract.recognize(file, 'eng+kor')
    .then(({ data: { text } }) => {
      words = text.split('\n')
        .map(line => line.trim())
        .filter(line => line.length > 0)
        .map(line => {
          const parts = line.split(' ');
          if (parts.length < 3) return null;

          const word = parts[0];
          const meaning = parts[parts.length - 1];
          const definition = parts.slice(1, parts.length - 1).join(' ');

          return { word, definition, meaning };
        })
        .filter(v => v !== null);

      if (words.length === 0) {
        alert("ë‹¨ì–´ë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\ní˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.");
        return;
      }

      shuffle(words);
      document.getElementById('upload').style.display = 'none';
      document.getElementById('quiz').style.display = 'block';
      show();
    });
}

function show() {
  document.getElementById('definition').innerText =
    `ì˜ì˜í’€ì´: ${words[index].definition}`;
  document.getElementById('wordInput').value = '';
  document.getElementById('meaningInput').value = '';
}

function next() {
  const wordAnswer = document.getElementById('wordInput').value.trim();
  const meaningAnswer = document.getElementById('meaningInput').value.trim();

  const correct =
    wordAnswer.toLowerCase() === words[index].word.toLowerCase() &&
    meaningAnswer === words[index].meaning;

  results.push({
    ...words[index],
    wordAnswer,
    meaningAnswer,
    correct
  });

  index++;
  if (index < words.length) show();
  else finish();
}

function finish() {
  document.getElementById('quiz').style.display = 'none';

  let score = results.filter(r => r.correct).length;
  let html = `<h3>ê²°ê³¼</h3>`;
  html += `<p>ì ìˆ˜: ${score} / ${results.length}</p><ul>`;

  results.forEach(r => {
    html += `
      <li>
        <strong>${r.definition}</strong><br>
        ì…ë ¥: ${r.wordAnswer || '-'} / ${r.meaningAnswer || '-'}<br>
        ì •ë‹µ: ${r.word} / ${r.meaning}
      </li><br>`;
  });

  html += `</ul><button onclick="location.reload()">ğŸ”„ ë‹¤ì‹œ ì‹œí—˜</button>`;
  document.getElementById('result').innerHTML = html;
  document.getElementById('result').style.display = 'block';
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}
</script>

</body>
</html>